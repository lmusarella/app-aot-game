<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="manifest" href="./manifest.json">
    <title>AOT Companion</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="40x40" href="assets/img/logo.jpg">

    <!-- iPad/iPhone: icona Home -->
    <link rel="apple-touch-icon" href="assets/img/logo.jpg">
    <!-- Avvio a schermo intero + status bar -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Service Worker registrato'))
                .catch(err => console.error('SW registration failed:', err));
        });
    }
</script>

<body>

    <!-- ===== HEADER minimal ===== -->
    <header>
        <div class="topbar">
            <!-- Logo / Icona -->
            <div class="logo-box">
                <img src="assets/img/logo.jpg" alt="Logo" />
            </div>

            <!-- Brand -->
            <div class="brand">AOT Companion</div>

            <!-- Centro: Missione + Timer -->
            <div class="center-box">
                <!-- Missione -->
                <div class="mission-ctrl">
                    <div class="mc-box">
                        <span class="mc-label">Missione Corrente</span>
                        <button id="m-dec" class="mc-btn" type="button" title="Missione precedente">−</button>
                        <span id="m-num" class="mc-num">1</span>
                        <button id="m-inc" class="mc-btn" type="button" title="Missione successiva">+</button>
                    </div>
                </div>

                <!-- Timer missione -->
                <div class="timer" title="Timer missione">
                    <span class="mc-label">Timer Missione</span>
                    <button id="t-play" class="t-btn" aria-label="Play/Pausa">▶</button>
                    <span id="t-time" class="t-time">00:00</span>
                    <button id="t-reset" class="t-btn" aria-label="Azzera timer">⟲</button>
                </div>
            </div>

            <!-- Reset partita (a destra) -->
            <button id="btn-reset-game" class="reset-hdr-btn" title="Reset Partita">
                RESET PARTITA
            </button>
        </div>
    </header>


    <!-- ===== MENU LATERALE SINISTRO ===== -->
    <nav class="leftbar" aria-label="Pannello laterale">
        <!-- Missione corrente (card pulsante) -->
        <section class="left-section">
            <div class="left-head">
                <h4>Obiettivo Missione</h4>
            </div>
            <div id="missione-corrente" class="left-content" style="padding-right:0;">
                <div id="mission-card" class="mission-card" role="button" tabindex="0"
                    aria-label="Apri dettagli missione corrente">
                    <p style="margin:0 0 8px; opacity:.9;"><strong>#<span id="mc-num">3</span> — Scorta
                            rifornimenti</strong></p>
                    <ul style="margin:0 0 10px 18px; padding:0; opacity:.9">
                        <li>Proteggi il convoglio per 5 turni</li>
                        <li>Evita che più di 2 carri vengano distrutti</li>
                    </ul>
                    <p style="margin:0; font-size:12px; opacity:.8">Ricompensa: +2 Morale, +200 XP</p>
                </div>
            </div>

        </section>

        <!-- Stato Squadra: Morale / XP + Bonus/Malus -->
        <section class="left-section">
            <div class="left-head">
                <h4>Bonus / Malus</h4>
            </div>
            <div class="left-content" style="padding-right:0;">

                <div style="margin-top:10px;">
                    <div style="font-size:12px; opacity:.85; margin-bottom:6px;"></div>
                    <div id="bm-box" class="pillbox">
                        <span class="pill bonus">+1 Ricognizione</span>
                        <span class="pill malus">-1 Meteo</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lancio Dadi (restyle) -->
        <section class="left-section dice-wrap">
            <div class="left-head">
                <h4>Lancio Dadi</h4>
            </div>
            <div id="dice-box" class="left-content">
                <div class="dice-actions">
                    <button id="roll-d20" class="die-btn" title="Tira d20">d20</button>
                    <button id="roll-d4" class="die-btn" title="Tira d4">d4</button>
                    <span id="dice-res" class="dice-res" aria-live="polite"></span>
                </div>
            </div>
        </section>

        <!-- Log partita (restyle) -->
        <section class="left-section log-wrap">
            <div class="left-head">
                <h4>Log partita</h4>
            </div>
            <div id="log-box" class="left-content"></div>
        </section>
    </nav>

    <!-- ===== COLONNA PANCHINE (DESTRA) ===== -->
    <aside>
        <section class="bench-section">
            <div class="bench-head">
                <h4>Squadra in missione</h4>
                <span id="count-allies" class="bench-count"></span>
            </div>
            <div id="bench-allies" class="bench" data-section="ally"></div>
        </section>

        <section class="bench-section" id="giants-section">
            <div class="bench-head">
                <h4>Giganti</h4>
                <span id="count-enemies" class="bench-count"></span>
            </div>
            <div id="bench-enemies" class="bench" data-section="enemy"></div>
        </section>

        <section class="bench-section accordion-section" id="walls-section" data-open="1">
            <div class="accordion-header">
                <button id="walls-toggle" class="accordion-trigger" type="button" aria-expanded="true"
                    aria-controls="walls-panel">
                    <h4 class="accordion-title">Mura</h4>
                    <span id="count-walls" class="bench-count"></span>
                    <span class="accordion-caret" aria-hidden="true">▾</span>
                </button>
            </div>

            <!-- wrapper = necessario per animazione fluida -->
            <div class="accordion-panel" id="walls-panel" role="region" aria-labelledby="walls-toggle"
                aria-hidden="false">
                <div class="accordion-inner">
                    <div id="bench-walls" class="bench" data-section="wall"></div>
                </div>
            </div>
        </section>


    </aside>

    <!-- ===== Tooltip ===== -->
    <div id="tooltip"></div>



    <!-- ===== CAMPO ===== -->
    <main>
        <div class="grid-wrapper">
            <div id="hex-grid"></div>
        </div>
    </main>

    <div id="snackbar-region" aria-live="polite" aria-atomic="true"></div>


    <!-- === FAB DOCK === -->
    <div class="fab-dock" aria-label="Azioni rapide">
        <!-- SPAWN -->
        <div id="fab-spawn" class="fab spawn" aria-expanded="false">
            <button class="fab-main spawn" type="button" title="Spawna un gigante">SPAWN</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-type="Puro" title="Gigante Puro" style="--angle:-65deg">Gigante
                    Puro</button>
                <button class="fab-option" data-type="Anomalo" title="Gigante Anomalo" style="--angle:-35deg">Gigante
                    Anomalo</button>
                <button class="fab-option" data-type="Mutaforma" title="Gigante Mutaforma" style="--angle:35deg">Gigante
                    Mutaforma</button>
                <button class="fab-option" data-type="Casuale" title="Gigante Casuale" style="--angle:65deg">Evento
                    Spawn</button>
            </div>
        </div>
        <!-- EVENTO -->
        <div id="fab-event" class="fab event" aria-expanded="false">
            <button class="fab-main event" type="button" title="Mazzo Carte">MAZZO</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-ev="evento" title="Pesca Evento" style="--angle:-50deg">Pesca
                    Evento <span class="deck-badge" data-deck-badge="event"></span></button>
                <button class="fab-option" data-ev="reshuffle" title="Rimescola gli scarti di tutti i mazzi"
                    style="--angle:0deg">
                    Rimescola Mazzi
                </button>
                <button class="fab-option" data-ev="consumabile" title="Pesca Consumabile" style="--angle:50deg">Pesca
                    Consumabile <span class="deck-badge" data-deck-badge="consumable"></span> </button>
            </div>
        </div>
        <!-- ARRUOLA -->
        <div id="fab-arruola" class="fab arruola" aria-expanded="false">
            <button class="fab-main arruola" type="button" title="Arruola unità">SQUADRA</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-role="recruit" title="Arruola Reclute" style="--angle:-40deg">Arruola
                    Reclute</button>
                <button class="fab-option" data-role="commander" title="Arruola Comandanti"
                    style="--angle:40deg">Arruola Comandanti</button>
            </div>
        </div>


    </div>

    <!-- ===== FOOTER overlay ===== -->
    <footer class="app-footer" aria-label="Footer">
        <!-- Barre compatte nel footer -->
        <div class="footer-bars" role="group" aria-label="Stato Squadra">
            <!-- Morale -->
            <div class="bar-row mini" id="morale-row">
                <span class="br-label">Morale</span>
                <button class="bbtn" data-target="morale" data-delta="-1" title="-1%">−</button>
                <div class="bar morale">
                    <div id="morale-fill" class="fill" style="width:65%"></div>
                </div>
                <button class="bbtn" data-target="morale" data-delta="1" title="+1%">+</button>

            </div>

            <!-- Esperienza -->
            <div class="bar-row mini" id="xp-row">
                <span class="br-label">
                    Exp <span id="lvl-val" style="margin-left:6px; opacity:.75; font-size:11px;">Lv. 1</span>
                </span>
                <button class="bbtn" data-target="xp" data-xp="-1" title="-1 XP">−</button>
                <div class="bar xp">
                    <div id="xp-fill" class="fill" style="width:40%"></div>
                </div>
                <button class="bbtn" data-target="xp" data-xp="+1" title="+1 XP">+</button>
                <!-- non serve più il br-val a destra -->
            </div>
        </div>
    </footer>


    <button id="toggle-left" class="collapse-handle left" aria-expanded="true" title="Comprimi/espandi menu sinistro">
        <span class="arrow">⟨</span>

    </button>

    <button id="toggle-right" class="collapse-handle right" aria-expanded="true" title="Comprimi/espandi menu destro">

        <span class="arrow">⟩</span>
    </button>

    <script src="script.js"></script>
    <!--<script type="module" src="src/app.js"></script>-->
</body>

</html>