<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="manifest" href="./manifest.json">
    <title>AOT Companion</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="40x40" href="assets/img/logo.jpg">

    <!-- iPad/iPhone: icona Home -->
    <link rel="apple-touch-icon" href="assets/img/logo.jpg">
    <!-- Avvio a schermo intero + status bar -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Service Worker registrato'))
                .catch(err => console.error('SW registration failed:', err));
        });
    }
</script>

<body>

    <!-- ===== HEADER minimal ===== -->
    <header>
        <div class="topbar">
            <!-- Logo / Icona -->
            <div class="logo-box">
                <img src="assets/img/logo.jpg" alt="Logo" />
            </div>

            <!-- Brand -->
            <div class="brand">AOT Companion</div>

            <!-- Centro: Missione + Timer -->
            <div class="center-box">
                <!-- Missione -->
                <div class="mission-ctrl">
                    <div class="mc-box">
                        <span class="mc-label">Missione</span>
                        <button id="m-dec" class="mc-btn" type="button" title="Missione precedente">âˆ’</button>
                        <span id="m-num" class="mc-num">1</span>
                        <button id="m-inc" class="mc-btn" type="button" title="Missione successiva">+</button>
                    </div>
                </div>

                <button id="btn-start" class="start-hdr-btn" data-mode="start" type="button"
                    title="Avvia missione">INIZIA</button>
                <!-- Timer missione -->
                <div class="timer" title="Timer missione">
                    <span class="mc-label">Timer</span>
                    <button id="t-play" class="t-btn" aria-label="Play/Pausa">â–¶</button>
                    <span id="t-time" class="t-time">00:00</span>
                    <button id="t-reset" class="t-btn" aria-label="Azzera timer">âŸ²</button>
                </div>

                <button id="btn-audio" class="btn-icon" title="Impostazioni audio" aria-label="Impostazioni audio">
                    ðŸŽ§
                </button>
              
            </div>

            <!-- Reset partita (a destra) -->
            <button id="btn-reset-game" class="reset-hdr-btn" title="Reset Partita">
                RESET PARTITA
            </button>
        </div>
    </header>


    <!-- ===== MENU LATERALE SINISTRO ===== -->
    <nav class="leftbar" aria-label="Pannello laterale">
        <!-- Missione corrente (card pulsante) -->
        <section class="left-section">
            <div class="left-head">
                <h4>Obiettivo Missione</h4>
            </div>
            <div id="missione-corrente" class="left-content" style="padding-right:0;">
                <div id="mission-card" class="mission-card" role="button" tabindex="0"
                    aria-label="Apri dettagli missione corrente">
                    <p style="margin:0 0 8px; opacity:.9;"><strong>#<span id="mc-num">3</span> â€” Scorta
                            rifornimenti</strong></p>
                    <ul style="margin:0 0 10px 18px; padding:0; opacity:.9">
                        <li>Proteggi il convoglio per 5 turni</li>
                        <li>Evita che piÃ¹ di 2 carri vengano distrutti</li>
                    </ul>
                    <p style="margin:0; font-size:12px; opacity:.8">Ricompensa: +2 Morale, +200 XP</p>
                </div>
            </div>

        </section>

        <!-- Stato Squadra: Morale / XP + Bonus/Malus -->
        <section class="left-section">
            <div class="left-head">
                <h4>Bonus / Malus</h4>
            </div>
            <div class="left-content" style="padding-right:0;">

                <div style="margin-top:10px;">
                    <div style="font-size:12px; opacity:.85; margin-bottom:6px;"></div>
                    <div id="bm-box" class="pillbox">
                        <span class="pill bonus">+1 Ricognizione</span>
                        <span class="pill malus">-1 Meteo</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lancio Dadi (restyle) -->
        <section class="left-section dice-wrap">
            <div class="left-head">
                <h4>Lancio Dadi</h4>
            </div>
            <div id="dice-box" class="left-content">
                <div class="dice-actions">
                    <button id="roll-d20" class="die-btn" title="Tira d20">d20</button>
                    <button id="roll-d4" class="die-btn" title="Tira d4">d4</button>
                    <span id="dice-res" class="dice-res" aria-live="polite"></span>
                </div>
            </div>
        </section>

        <!-- Log partita (restyle) -->
        <section class="left-section log-wrap">
            <div class="left-head">
                <h4>Log partita</h4>
            </div>
            <div id="log-box" class="left-content"></div>
        </section>
    </nav>

    <!-- ===== COLONNA PANCHINE (DESTRA) ===== -->
    <aside>
        <!-- SQUADRA -->
        <section class="bench-section accordion-section" id="allies-section" data-open="0">
            <div class="accordion-header">
                <button class="accordion-trigger" type="button" aria-expanded="true" aria-controls="allies-panel">
                    <h4 class="accordion-title">Squadra in missione</h4>
                    <span id="count-allies" class="bench-count"></span>
                    <span class="accordion-caret" aria-hidden="true">â–¾</span>
                </button>
            </div>
            <div class="accordion-panel" id="allies-panel" role="region" aria-hidden="false">
                <div class="accordion-inner">
                    <div id="bench-allies" class="bench" data-section="ally"></div>
                </div>
            </div>
        </section>

        <!-- GIGANTI -->
        <section class="bench-section accordion-section" id="giants-section" data-open="0">
            <div class="accordion-header">
                <button class="accordion-trigger" type="button" aria-expanded="false" aria-controls="giants-panel">
                    <h4 class="accordion-title">Giganti in campo</h4>
                    <span id="count-enemies" class="bench-count"></span>
                    <span class="accordion-caret" aria-hidden="true">â–¾</span>
                </button>
            </div>
            <div class="accordion-panel" id="giants-panel" role="region" aria-hidden="true">
                <div class="accordion-inner">
                    <div id="bench-enemies" class="bench" data-section="enemy"></div>
                </div>
            </div>
        </section>


        <section class="bench-section accordion-section" id="walls-section" data-open="1">
            <div class="accordion-header">
                <button id="walls-toggle" class="accordion-trigger" type="button" aria-expanded="true"
                    aria-controls="walls-panel">
                    <h4 class="accordion-title">Mura</h4>
                    <span id="count-walls" class="bench-count"></span>
                    <span class="accordion-caret" aria-hidden="true">â–¾</span>
                </button>
            </div>

            <!-- wrapper = necessario per animazione fluida -->
            <div class="accordion-panel" id="walls-panel" role="region" aria-labelledby="walls-toggle"
                aria-hidden="false">
                <div class="accordion-inner">
                    <div id="bench-walls" class="bench" data-section="wall"></div>
                </div>
            </div>
        </section>


    </aside>

    <!-- ===== Tooltip ===== -->
    <div id="tooltip"></div>


    <!-- Popup Audio -->
    <div id="audio-backdrop" class="modal-backdrop"></div>
    <div id="audio-modal" class="modal modal-audio" role="dialog" aria-modal="true" aria-labelledby="audio-title">
        <div class="modal-header">
            <span id="audio-title" class="modal-title">Impostazioni Audio</span>
            <button class="modal-close" data-close aria-label="Chiudi">Ã—</button>
        </div>
        <div class="modal-body">
            <!-- la stessa card di prima -->
            <div class="vol-card" id="vol-card" role="region" aria-label="Controlli volume">
                <div class="vol-row">
                    <div class="vol-head">
                        <span class="vol-ico" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12 3v10.55A4 4 0 1 1 10 17V8h8V3h-6z" />
                            </svg>
                        </span>
                        <span class="vol-title">Musica</span>
                        <output id="vol-music-val" class="vol-val">22%</output>
                    </div>
                    <input id="vol-music" class="vol-range music" type="range" min="0" max="100" step="1" value="22"
                        data-prop="music" />
                </div>

                <div class="vol-row">
                    <div class="vol-head">
                        <span class="vol-ico" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M13 3L4 14h6l-1 7 9-11h-6l1-7z" />
                            </svg>
                        </span>
                        <span class="vol-title">Effetti</span>
                        <output id="vol-sfx-val" class="vol-val">80%</output>
                    </div>
                    <input id="vol-sfx" class="vol-range sfx" type="range" min="0" max="100" step="1" value="80"
                        data-prop="sfx" />
                </div>
            </div>
        </div>
    </div>


    <!-- ===== CAMPO ===== -->
    <main>
        <div class="grid-wrapper">
            <div id="hex-grid"></div>
        </div>
    </main>

    <div id="snackbar-region" aria-live="polite" aria-atomic="true"></div>


    <!-- === FAB DOCK === -->
    <div class="fab-dock" aria-label="Azioni rapide">
        <!-- SPAWN -->
        <div id="fab-spawn" class="fab spawn" aria-expanded="false">
            <button class="fab-main spawn" type="button" title="Spawna un gigante">SPAWN</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-type="Puro" title="Gigante Puro" style="--angle:-65deg">Gigante
                    Puro</button>
                <button class="fab-option" data-type="Anomalo" title="Gigante Anomalo" style="--angle:-35deg">Gigante
                    Anomalo</button>
                <button class="fab-option" data-type="Mutaforma" title="Gigante Mutaforma" style="--angle:35deg">Gigante
                    Mutaforma</button>
                <button class="fab-option" data-type="Casuale" title="Gigante Casuale" style="--angle:65deg">Evento
                    Spawn</button>
            </div>
        </div>
        <!-- EVENTO -->
        <div id="fab-event" class="fab event" aria-expanded="false">
            <button class="fab-main event" type="button" title="Carte">CARTE</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-ev="evento" title="Pesca Evento" style="--angle:-65deg">Pesca
                    Evento <span class="deck-badge" data-deck-badge="event"></span></button>
                <button class="fab-option" data-ev="reshuffle" title="Rimescola gli scarti di tutti i mazzi"
                    style="--angle:-35deg">
                    Rimescola Mazzi
                </button>
                <button class="fab-option" data-ev="showhand" title="Carte in mano" style="--angle:35deg">Carte in
                    mano <span class="deck-badge" data-deck-badge="showhand"></span></button>
                <button class="fab-option" data-ev="consumabile" title="Pesca Consumabile" style="--angle:65deg">Pesca
                    Consumabile <span class="deck-badge" data-deck-badge="consumable"></span> </button>
            </div>
        </div>

        <!-- ARRUOLA -->
        <div id="fab-arruola" class="fab arruola" aria-expanded="false">
            <button class="fab-main arruola" type="button" title="Arruola unitÃ ">SQUADRA</button>
            <div class="fab-options" aria-hidden="true">
                <button class="fab-option" data-role="recruit" title="Arruola Reclute" style="--angle:-50deg">Arruola
                    Reclute</button>
                <button class="fab-option" data-role="random-team" title="Squadra casuale" style="--angle:0deg">
                    Squadra casuale
                </button>
                <button class="fab-option" data-role="commander" title="Arruola Comandanti"
                    style="--angle:50deg">Arruola Comandanti</button>
            </div>
        </div>


    </div>

    <!-- ===== FOOTER overlay ===== -->
    <footer class="app-footer" aria-label="Footer">
        <!-- Barre compatte nel footer -->
        <div class="footer-bars" role="group" aria-label="Stato Squadra">
            <!-- Morale -->
            <div class="bar-row mini" id="morale-row">
                <span class="br-label">Morale</span>
                <button class="bbtn" data-target="morale" data-delta="-1" title="-1%">âˆ’</button>
                <div class="bar morale">
                    <div id="morale-fill" class="fill" style="width:65%"></div>
                </div>
                <button class="bbtn" data-target="morale" data-delta="1" title="+1%">+</button>

            </div>

            <!-- Esperienza -->
            <div class="bar-row mini" id="xp-row">
                <span class="br-label">
                    Exp <span id="lvl-val" style="margin-left:6px; opacity:.75; font-size:11px;">Lv. 1</span>
                </span>
                <button class="bbtn" data-target="xp" data-xp="-1" title="-1 XP">âˆ’</button>
                <div class="bar xp">
                    <div id="xp-fill" class="fill" style="width:40%"></div>
                </div>
                <button class="bbtn" data-target="xp" data-xp="+1" title="+1 XP">+</button>
                <!-- non serve piÃ¹ il br-val a destra -->
            </div>
        </div>
    </footer>

    <!-- Overlay Mano (creato/riempito via JS) -->
    <!-- Overlay Carte (mano / pesca) -->
    <div id="hand-overlay" class="hand-overlay" hidden>
        <div class="hand-backdrop"></div>
        <div class="hand-stage hand-stage--strip" role="dialog" aria-modal="true" aria-label="Carte">
            <div class="hand-strip" id="hand-strip" tabindex="0" aria-live="polite"></div>
            <button class="hand-close" title="Chiudi" aria-label="Chiudi">Ã—</button>
        </div>
    </div>


    <button id="toggle-left" class="collapse-handle left" aria-expanded="true" title="Comprimi/espandi menu sinistro">
        <span class="arrow">âŸ¨</span>
    </button>

    <button id="toggle-right" class="collapse-handle right" aria-expanded="true" title="Comprimi/espandi menu destro">
        <span class="arrow">âŸ©</span>
    </button>

    <script src="script.js"></script>
    <!--<script type="module" src="src/app.js"></script>-->
</body>

</html>